apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ./cluster-apps-project.yaml
  - ../../../manifests/argocd/apps/nfs-provisioner/base
  - ../../../manifests/argocd/apps/certificates/base
  - ../../../manifests/argocd/apps/nfs-provisioner/overlays/backups
  - ../../../manifests/argocd/apps/cloudflared/base
  - ../../../manifests/argocd/apps/cluster-monitoring/base
  - ../../../manifests/argocd/apps/volsync/base
  - ../../../manifests/argocd/apps/devspaces/base
  - ../../../manifests/argocd/apps/machineconfig/base
  - ../../../manifests/argocd/apps/pmb-tekton/base
  - ../../../manifests/argocd/apps/immich/base
  - ../../../manifests/argocd/apps/resilio-sync/base
  - ../../../manifests/argocd/apps/homeassistant-influx/base
  - ../../../manifests/argocd/apps/cert-manager/overlays/sakaarr
  - ../../../manifests/argocd/apps/homeassistant-db/overlays/sakaarr
  - ../../../manifests/argocd/apps/paperless-ng/overlays/sakaarr
  - ../../../manifests/argocd/apps/vaultwarden/overlays/sakaarr
  - ../../../manifests/argocd/apps/keycloak/overlays/sakaarr
  - ../../../manifests/argocd/apps/node-red/overlays/sakaarr
  - ../../../manifests/argocd/apps/sharry/overlays/sakaarr
  - ../../../manifests/argocd/apps/sealed-secrets-operator/overlays/titan
  - ../../../manifests/argocd/apps/oauth/base
  - ../../../manifests/argocd/apps/groups-and-membership/base

patches:
  - path: patch-gitops-repo.yaml
    target:
      group: argoproj.io
      kind: Application
      labelSelector: gitops.ownedBy=cluster-config
      version: v1alpha1
  - path: patch-target-revision.yaml
    target:
      group: argoproj.io
      kind: Application
      labelSelector: gitops.ownedBy=cluster-config
      version: v1alpha1
  - path: patch-destination.yaml
    target:
      group: argoproj.io
      kind: Application
      labelSelector: gitops.type=app-of-apps
      version: v1alpha1
  - patch: |-
      - op: replace
        path: /metadata/name
        value: cert-manager-config
    target:
      group: argoproj.io
      kind: Application
      name: cert-manager
      version: v1alpha1
  - path: add-finalizer.yaml
    target:
      group: argoproj.io
      kind: Application
      version: v1alpha1
